<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BlogShare Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">BlogShare</a>
            <div class="collapse navbar-collapse justify-content-end">
                <span class="navbar-text text-white me-3">Hi, {{ user.username }}</span>
                <a href="{% url 'logout' %}" class="btn btn-outline-light">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">My Blog Posts</h2>
            <a href="{% url 'create_post' %}" class="btn btn-success">+ New Post</a>
        </div>

        <form method="get" action="" class="mb-4">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Search blogs..." value="{{ request.GET.q }}">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
        </form>

        {% for post in posts %}
            <div class="card mb-4 shadow">
                {% if post.image %}
                     <img src="{{post.image.url}}" class="img-fluid mb-3" alt="post image">
                {% endif %}
                <div class="card-body">
                    <h4 class="card-title">{{ post.title }}</h4>
                    <p class="card-text">{{ post.content|truncatewords:30 }}</p>
                    <p class="text-muted">By {{ post.author.username }} | {{ post.created_at|date:"M d, Y H:i" }}</p>

                    <div class="d-flex gap-2">
                        {% if post.author == user %}
                            <a href="{% url 'edit_post' post.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
                            <a href="{% url 'delete_post' post.id %}" class="btn btn-sm btn-outline-danger">Delete</a>
                        {% endif %}
                    </div>
                </div>
<!--<div id="comments">-->
<!--                <div class="card-footer">-->
<!--                    <h6>Comments</h6>-->
<!--                    {% for comment in post.comments.all %}-->
<!--                        <div class="mb-2">-->
<!--                            {% if comment.id == editing_comment_id %}-->
<!--                <form method="post" action="{% url 'edit_comment' comment.id %}">-->
<!--        {% csrf_token %}-->
<!--                <div class="input-group">-->
<!--                    <input type="text" name="content" class="form-control" value="{{ comment.content }}">-->
<!--                    <button class="btn btn-success" type="submit">Update</button>-->
<!--                </div>-->
<!--                </form>-->
<!--        {% else %}-->
<!--              <strong>{{ comment.author.username }}</strong>: {{ comment.content }}-->
<!--        {% if comment.author == user %}-->
<!--              <a href="?edit_comment_id={{ comment.id }}" class="text-primary small ms-2">Edit</a>-->
<!--              <a href="{% url 'delete_comment' comment.id %}" class="text-danger small ms-2">Delete</a>-->
<!--        {% endif %}-->
<!--                   {% endif %}-->
<!--                        </div>-->
<!--                    {% empty %}-->
<!--                        <p class="text-muted">No comments yet.</p>-->
<!--                    {% endfor %}-->

<!--                    <form method="post" action="{% url 'add_comment' post.id %}" class="mt-3">-->
<!--                        {% csrf_token %}-->
<!--                        <div class="input-group">-->
<!--                            <input type="text" name="content" class="form-control" placeholder="Add a comment..." required>-->
<!--                            <button class="btn btn-outline-secondary" type="submit">Post</button>-->
<!--                        </div>-->
<!--                    </form>-->
<!--                </div>-->
<!--            </div>-->
<!--            </div>-->

        <div class="card-footer" id="comments-{{ post.id }}">
    <h6>Comments</h6>
    <ul class="list-group mb-3" id="comment-list-{{ post.id }}">
        {% for comment in post.comments.all|slice:":2" %}
            <li class="list-group-item">
                <strong>{{ comment.author.username }}</strong>: {{ comment.content }}
                <br><small class="text-muted">{{ comment.created_at|date:"M d, Y H:i" }}</small>
            </li>
        {% empty %}
            <li class="list-group-item">No comments yet.</li>
        {% endfor %}
      {% for comment in post.comments.all|slice:"2:" %}
            <li class="list-group-item d-none extra-comment extra-{{ post.id }}">
                <strong>{{ comment.author.username }}</strong>: {{ comment.content }}
                <br><small class="text-muted">{{ comment.created_at|date:"M d, Y H:i" }}</small>
            </li>
        {% endfor %}
    </ul>

  {% if post.comments.count > 2 %}
    <button class="btn btn-link p-0" onclick="toggleComments({{ post.id }})" id="toggle-btn-{{ post.id }}">
      See more
    </button>
  {% endif %}

    <form method="POST" action="?page={{ posts.number }}#comments-{{ post.id }}">
        {% csrf_token %}
        <input type="hidden" name="post_id" value="{{ post.id }}">
        <div class="input-group">
            <input type="text" name="content" class="form-control" placeholder="Add a comment..." required>
            <button class="btn btn-outline-secondary" type="submit">Post</button>
        </div>
    </form>
</div>

        {% endfor %}

        <div class="d-flex justify-content-center">
            {% if posts.has_previous %}
                <a href="?page={{ posts.previous_page_number }}" class="btn btn-outline-primary me-2">Previous</a>
            {% endif %}

            {% if posts.has_next %}
                <a href="?page={{ posts.next_page_number }}" class="btn btn-outline-primary">Next</a>
            {% endif %}
        </div>
    </div>
    </div>
<script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>
